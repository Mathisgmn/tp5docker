services:
  redis:
    image: redis:7
    restart: unless-stopped

  backend:
    build: ./backend
    env_file: .env
    environment:
      BACKEND_PORT: ${BACKEND_PORT}
    restart: unless-stopped
    depends_on:
      - redis
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "node -e \"require('http').get('http://localhost:' + (process.env.BACKEND_PORT || 8080), res => process.exit(res.statusCode === 200 ? 0 : 1)).on('error', () => process.exit(1))\"",
        ]
      interval: 10s
      timeout: 5s
      retries: 5
    ports:
      - "${BACKEND_PORT}:${BACKEND_PORT}"
    volumes:
      - ./backend:/app
      - /app/node_modules
  frontend:
    build: ./frontend
    env_file: .env
    ports:
      - "${FRONTEND_PORT}:5173"
    volumes:
      - ./frontend:/app
      - /app/node_modules
